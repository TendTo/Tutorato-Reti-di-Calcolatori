var _a;function assert(t,e,s=Error){if(!t)throw new s(e||"Assertion failed")}export function querySelector(t,e){let s=document.querySelector(t);if(!s)throw Error(`Element not found: ${t}`);if(!(s instanceof e))throw TypeError(`Element is not a ${e.constructor.name}`);return s}export class BitArray{static getNewWordArray(t,e){if(8===t)return new Uint8Array(e);if(16===t)return new Uint16Array(e);if(32===t)return new Uint32Array(e);if(t===Uint8Array||t===Uint16Array||t===Uint32Array)return new t(e);if(t instanceof Uint8Array)return new Uint8Array(e);else if(t instanceof Uint16Array)return new Uint16Array(e);else if(t instanceof Uint32Array)return new Uint32Array(e);else throw TypeError("Invalid word size. Must be 8, 16 or 32")}constructor(t,e=32){if("number"==typeof t)this._length=t,this._buffer=new ArrayBuffer(Math.ceil(this._length/e)*e/8),this._wordArray=BitArray.getNewWordArray(e,this._buffer);else if(t instanceof BitArray){this._length=t.length,this._buffer=new ArrayBuffer(t._buffer.byteLength),this._wordArray=BitArray.getNewWordArray(t._wordArray,this._buffer);for(let s=0;s<t._wordArray.length;s++)this._wordArray[s]=t._wordArray[s]}else if(t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array){this._length=8*t.byteLength,this._buffer=new ArrayBuffer(t.byteLength),this._wordArray=BitArray.getNewWordArray(t,this._buffer);for(let r=0;r<t.length;r++)this._wordArray[r]=t[r]}else throw TypeError("Invalid type. Must be number, BitArray, Uint32Array or Uint8Array")}get length(){return this._length}get buffer(){return this._buffer.slice(0)}get wordArray(){return this._wordArray.slice(0)}get wordSize(){if(this._wordArray instanceof Uint8Array)return 8;if(this._wordArray instanceof Uint16Array)return 16;if(this._wordArray instanceof Uint32Array)return 32;throw TypeError("Invalid type. Must be Typed Array")}get moduleMask(){return this.wordSize-1}get maxValue(){return Math.pow(2,this.wordSize)-1}get bitsPerElement(){return 8*this._wordArray.BYTES_PER_ELEMENT}_getBitMask(t){return 1<<this.bitsPerElement-1-(t&this.moduleMask)}_getWordIdx(t){return Math.floor(t/this.wordSize)}set(t,e){assert(t>=0&&t<this.length,`Index must be between 0 and ${this.length-1}`,RangeError);let s=this._getWordIdx(t);e?this._wordArray[s]|=this._getBitMask(t):this._wordArray[s]&=~this._getBitMask(t)}get(t){assert(t>=0&&t<this.length,`Index must be between 0 and ${this.length-1}`,RangeError);let e=this._getWordIdx(t);return(this._wordArray[e]&this._getBitMask(t))!=0}toggle(t){assert(t>=0&&t<this.length,`Index must be between 0 and ${this.length-1}`,RangeError);let e=this._getWordIdx(t);this._wordArray[e]^=this._getBitMask(t)}reset(){this._buffer=new ArrayBuffer(this._wordArray.byteLength),this._wordArray=BitArray.getNewWordArray(this._wordArray,this._buffer)}copy(){let t=new BitArray(this.length,this.wordSize);for(let e=0;e<this._wordArray.length;e++)t._wordArray[e]=this._wordArray[e];return t}equals(t){if(this.length!==t.length)return!1;for(let e=0;e<this._wordArray.length;e++)if(this._wordArray[e]!==t._wordArray[e])return!1;return!0}toArray(){let t=[];for(let e=0;e<this.length;e++)t.push(this.get(e));return t}toJSON(){return JSON.stringify(this.toArray())}toBinaryString(){return this.toArray().map(t=>t?"1":"0").join("")}toUint8Array(){return new Uint8Array(this._buffer.slice(0))}toUint16Array(){return new Uint16Array(this._buffer.slice(0))}toUint32Array(){return new Uint32Array(this._buffer.slice(0))}setAll(t){let e=(1<<this.wordSize)-1;for(let s=0;s<this._wordArray.length;s++)this._wordArray[s]=t?e:0}setToTrueAfter(t){this.setToAfter(t,!0)}setToFalseAfter(t){this.setToAfter(t,!1)}setToAfter(t,e){if(t<0||t>=this.length)return;let s=(1<<this.wordSize)-1,r=this._getWordIdx(t),i=(1<<this.bitsPerElement-(t&this.moduleMask))-1;e?this._wordArray[r]|=i:this._wordArray[r]&=~i;for(let a=r+1;a<this._wordArray.length;a++)this._wordArray[a]=e?s:0}not(){for(let t=0;t<this._wordArray.length;t++)this._wordArray[t]=~this._wordArray[t];return this}or(t){if(this.length!==t.length)throw TypeError("Arguments must be of the same length.");for(let e=0;e<this._wordArray.length;e++)this._wordArray[e]|=t._wordArray[e];return this}and(t){if(this.length!==t.length)throw TypeError("Arguments must be of the same length.");for(let e=0;e<this._wordArray.length;e++)this._wordArray[e]&=t._wordArray[e];return this}xor(t){if(this.length!==t.length)throw TypeError("Arguments must be of the same length.");for(let e=0;e<this._wordArray.length;e++)this._wordArray[e]^=t._wordArray[e];return this}toString(){return this.toBinaryString()}}export class IP{get maxMask(){return this._bits.length}get bytes(){return this._bits}get mask(){return this._mask}get netmask(){let t=new BitArray(this._bits);return t.setAll(!0),t.setToFalseAfter(this._mask),t.wordArray}isValidMask(t){return"number"==typeof t&&t>=1&&t<=this.maxMask}constructor(t,e){if(t instanceof Uint8Array||t instanceof Uint16Array)this._bits=new BitArray(t);else if(t instanceof BitArray)this._bits=t.copy();else throw TypeError("Invalid type. Must be string, array or Uint8Array");if(!this.isValidMask(e))throw TypeError(`Mask must be a number between 0 and ${this.maxMask}`);this._mask=e}set mask(t){assert(this.isValidMask(t),`Mask must be a number between 0 and ${this.maxMask}`,RangeError),this._mask=t}get numIPs(){return 1<<this.maxMask-this._mask}getChildren(){return[this.left,this.right]}get _left(){assert(this._mask<this.maxMask,`Cannot get children if mask is already ${this.maxMask}`,RangeError);let t=this._bits.copy();return t.set(this._mask,!1),t}get _right(){assert(this._mask<this.maxMask,`Cannot get children if mask is already ${this.maxMask}`,RangeError);let t=this._bits.copy();return t.set(this._mask,!0),t}}export class IPv4 extends IP{static isIPv4(t){return _a.ipRegex.test(t)}constructor(t,e){t instanceof Uint8Array?assert(4===t.length,"Uint8Array must have 4 elements",RangeError):t instanceof BitArray?assert(32===t.length,"BitArray must have 32 elements",RangeError):Array.isArray(t)?t=_a._parseArray(t):"string"==typeof t&&(t=_a._parseString(t)),super(t,e)}static _parseString(t){let e=t.match(_a.ipRegex);if(!e||5!==e.length)throw TypeError(`Invalid IPv4 address: '${t}'`);return new Uint8Array(e.slice(1).map(t=>{let e=parseInt(t);return e}))}static _parseArray(t){return assert(4===t.length,"Array must have 4 elements",RangeError),assert(t.every(t=>t>=0&&t<=255),"Elements of the array must be between 0 and 255",RangeError),new Uint8Array(t)}get network(){let t=this._bits.copy();return t.setToFalseAfter(this._mask),new _a(t,this._mask)}get broadcast(){let t=this._bits.copy();return t.setToTrueAfter(this._mask),new _a(t,this._mask)}get numHosts(){return this._mask===this.maxMask?1:this._mask===this.maxMask-1?2:(1<<this.maxMask-this._mask)-2}get left(){return new _a(this._left,this._mask+1)}get right(){return new _a(this._right,this._mask+1)}get first(){if(this._mask===this.maxMask)return this;if(this._mask===this.maxMask-1){let t=this._bits.copy();return t.set(this.maxMask-1,!1),new _a(t,this._mask)}let e=this._bits.copy();return e.setToFalseAfter(this._mask),e.set(this.maxMask-1,!0),new _a(e,this._mask)}get last(){if(this._mask===this.maxMask)return this;if(this._mask===this.maxMask-1){let t=this._bits.copy();return t.set(this.maxMask-1,!0),new _a(t,this._mask)}let e=this._bits.copy();return e.setToTrueAfter(this._mask),e.set(this.maxMask-1,!1),new _a(e,this._mask)}getChildren(){return[this.left,this.right]}toString(){return`${this._bits.toUint8Array().join(".")}/${this._mask}`}ipToString(){return`${this._bits.toUint8Array().join(".")}`}}_a=IPv4,IPv4.ipv4PartRegex="(0*(?:25[0-5]|(?:2[0-4]|1\\d|[1-9]|)\\d))",IPv4.ipRegex=RegExp(`^${_a.ipv4PartRegex}\\.${_a.ipv4PartRegex}\\.${_a.ipv4PartRegex}\\.${_a.ipv4PartRegex}$`);export class IPv6 extends IP{static isIPv6(t){return IPv6.ipv6Regex.test(t)}constructor(t,e){t instanceof Uint16Array?assert(8===t.length,"Uint16Array must have 8 elements",RangeError):t instanceof BitArray?assert(128===t.length,"BitArray must have 128 elements",RangeError):Array.isArray(t)?t=IPv6._parseArray(t):"string"==typeof t&&(t=IPv6._parseString(t)),super(t,e)}static _parseString(t){assert(IPv6.ipv6Regex.test(t),`Invalid IPv6 address: ${t}`,TypeError);let e=new Uint16Array(8),s=t.split("::");if(2===s.length){let r=s[0].split(":"),i=s[1].split(":");1===r.length&&""===r[0]&&(r=[]),1===i.length&&""===i[0]&&(i=[]);let a=8-(r.length+i.length);for(let h=0;h<r.length;h++)e[h]=parseInt(r[h],16);for(let n=0;n<i.length;n++)e[a+n]=parseInt(i[n],16)}else if(1===s.length){let o=t.split(":");assert(8===o.length,"Invalid IPv6 address",TypeError);for(let l=0;l<o.length;l++){let u=parseInt(o[l],16);assert(!isNaN(u)&&0<=u&&u<=65535,`Invalid IPv6 address: ${t}`,TypeError),e[l]=u}}else throw TypeError(`Invalid IPv6 address: ${t}`);return e}static _parseArray(t){return assert(8===t.length,"Array must have 4 elements",RangeError),assert(t.every(t=>t>=0&&t<=65535),"Elements of the array must be between 0 and 0xffff",RangeError),new Uint16Array(t)}get network(){let t=this._bits.copy();return t.setToFalseAfter(this._mask),new IPv6(t,this._mask)}get broadcast(){throw Error("No broadcast address for IPv6")}get numHosts(){return this.numIPs}get left(){return new IPv6(this._left,this._mask+1)}get right(){return new IPv6(this._right,this._mask+1)}get first(){if(this._mask===this.maxMask)return this;let t=this._bits.copy();return t.setToFalseAfter(this._mask),new IPv6(t,this._mask)}get last(){if(this._mask===this.maxMask)return this;let t=this._bits.copy();return t.setToTrueAfter(this._mask),new IPv6(t,this._mask)}getChildren(){return[this.left,this.right]}toString(){return`${this.ipToString()}/${this._mask}`}ipToString(){let t=[],e=this._bits.toUint16Array();for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return`${t.join(":")}`}}IPv6.ipv6Regex=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;export class IpNode{constructor(t,e,s,r,i){this._value=t,this._x=e,this._y=s,this._width=r,this._height=i}get value(){return this._value}isClicked(t,e){return t>=this._x&&t<=this._x+this._width&&e>=this._y&&e<=this._y+this._height}draw(t){t.drawRect(this._x,this._y,this._width,this._height,"white","black");let e=Math.ceil(Math.min(16,this._width/10));t.drawText(this._value.toString(),this._x+this._width/2,this._y+this._height/2,{font:`${e}px sans-serif`})}getChildren(){let[t,e]=this._value.getChildren();return[new IpNode(t,this._x,this._y+this._height,this._width/2,this._height),new IpNode(e,this._x+this._width/2,this._y+this._height,this._width/2,this._height),]}}export class CanvasDrawer{constructor(t="#canvas"){this._ipNodes=[],this._canvas=querySelector(t,HTMLCanvasElement);let e=this._canvas.parentNode.getBoundingClientRect();this._canvas.width=e.width,this._canvas.height=e.height;let s=this._canvas.getContext("2d",{alpha:!1});if(!s)throw Error("Could not get 2d context");this._ctx=s,this._addListeners()}_addListeners(){this._canvas.addEventListener("click",this._onMouseClick.bind(this))}_onMouseClick(t){var e;for(let s of this._ipNodes)if(s.isClicked(t.offsetX,t.offsetY)){null===(e=this.onMouseClick)||void 0===e||e.call(this,s.value);break}}get canvas(){return this._canvas}get context(){return this._ctx}clear(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}drawRect(t,e,s,r,i,a){i&&(this._ctx.fillStyle=i,this._ctx.fillRect(t,e,s,r)),a&&(this._ctx.strokeStyle=a,this._ctx.strokeRect(t,e,s,r))}drawText(t,e,s,{align:r,baseline:i,fill:a,font:h}={}){this._ctx.font=null!=h?h:"16px sans-serif",this._ctx.fillStyle=null!=a?a:"black",this._ctx.textAlign=null!=r?r:"center",this._ctx.textBaseline=null!=i?i:"middle",this._ctx.fillText(t,e,s)}drawLine(t,e,s,r,i){let a=new Path2D;a.moveTo(t,e),a.lineTo(s,r),this._ctx.strokeStyle=null!=i?i:"black",this._ctx.stroke(a)}drawIpTree(t,e){if(e<1)return;let s=Math.floor(this._canvas.height/e),r=new IpNode(t,0,0,this._canvas.width,s),i=[r];this._ipNodes=[r],r.draw(this);let a=(1<<e)-1;for(;this._ipNodes.length<a;){let h=i.shift();if(!h)break;try{let[n,o]=h.getChildren();i.push(n,o),this._ipNodes.push(n,o),n.draw(this),o.draw(this)}catch(l){break}}}}export class InputManager{constructor(t="#ipRoot",e="#maskRoot",s="#treeHeight",r="#toNetwork"){this._ipRoot=querySelector(t,HTMLInputElement),this._maskRoot=querySelector(e,HTMLInputElement),this._treeHeight=querySelector(s,HTMLInputElement),this._toNetwork=querySelector(r,HTMLInputElement),this._ip=new IPv4(this._ipRoot.value,this._maskRoot.valueAsNumber),this._treeHeightValue=this._treeHeight.valueAsNumber,this._toNetworkValue=this._toNetwork.checked,this._addListeners()}_addListeners(){this._treeHeight.addEventListener("input",this._onTreeHeightClick.bind(this)),this._maskRoot.addEventListener("input",this._maskRootInput.bind(this)),this._ipRoot.addEventListener("input",this._onIpRootInput.bind(this)),this._toNetwork.addEventListener("change",this._onToNetworkChange.bind(this))}_onIpRootInput(t){var e;if(!(t.target instanceof HTMLInputElement)||!t.target.validity.valid)return;let s=this._ip.mask;IPv4.isIPv4(t.target.value)?(this._maskRoot.max="32",this._maskRoot.valueAsNumber>32&&(this._maskRoot.value="32",s=32),this._ip=new IPv4(t.target.value,s)):(this._maskRoot.max="128",this._ip=new IPv6(t.target.value,s)),null===(e=this.onUpdateIp)||void 0===e||e.call(this,this._ip,this._treeHeightValue,this._toNetworkValue)}_maskRootInput(t){var e;t.target instanceof HTMLInputElement&&t.target.validity.valid&&(this._ip.mask=t.target.valueAsNumber,null===(e=this.onUpdateIp)||void 0===e||e.call(this,this._ip,this._treeHeightValue,this._toNetworkValue))}_onTreeHeightClick(t){var e;t.target instanceof HTMLInputElement&&t.target.validity.valid&&(this._treeHeightValue=t.target.valueAsNumber,null===(e=this.onUpdateIp)||void 0===e||e.call(this,this._ip,this._treeHeightValue,this._toNetworkValue))}_onToNetworkChange(t){var e;t.target instanceof HTMLInputElement&&(this._toNetworkValue=t.target.checked,null===(e=this.onUpdateIp)||void 0===e||e.call(this,this._ip,this._treeHeightValue,this._toNetworkValue))}get ip(){return this._ip}get treeHeight(){return this._treeHeight.valueAsNumber}get toNetworkValue(){return this._toNetworkValue}}export class InfoManager{constructor(t="#showIp",e="#showNetmask",s="#showNetwork",r="#showBroadcast",i="#showMinIp",a="#showMaxIp",h="#showNumIp",n="#showNumHost"){this._showIp=querySelector(t,HTMLSpanElement),this._showNetmask=querySelector(e,HTMLSpanElement),this._showNetwork=querySelector(s,HTMLSpanElement),this._showBroadcast=querySelector(r,HTMLSpanElement),this._showMinIp=querySelector(i,HTMLSpanElement),this._showMaxIp=querySelector(a,HTMLSpanElement),this._showNumIp=querySelector(h,HTMLSpanElement),this._showNumHost=querySelector(n,HTMLSpanElement),this.update()}update(t){if(!t){this._showIp.textContent="",this._showNetmask.textContent="",this._showNetwork.textContent="",this._showBroadcast.textContent="",this._showMinIp.textContent="",this._showMaxIp.textContent="",this._showNumIp.textContent="",this._showNumHost.textContent="";return}if(this._showIp.textContent=t.toString(),t instanceof IPv4)this._showNetmask.textContent=t.netmask.join("."),this._showNetwork.textContent=t.network.ipToString(),this._showBroadcast.textContent=t.broadcast.ipToString();else{let e=[];t.netmask.forEach(t=>e.push(t.toString(16))),this._showNetmask.textContent=e.join(":")}this._showMinIp.textContent=t.first.ipToString(),this._showMaxIp.textContent=t.last.ipToString(),t.maxMask-t.mask<31?(this._showNumIp.textContent=t.numIPs.toLocaleString(),this._showNumHost.textContent=t.numHosts.toLocaleString()):(this._showNumIp.textContent="2^"+(t.maxMask-t.mask),this._showNumHost.textContent=`2^${t.maxMask-t.mask} ${t instanceof IPv4?" - 2":""}`)}}window.onload=()=>{console.log("%c There is not much to see here. Just a canvas and a bunch of inputs.\nIf you are just curious about how its made, you can find everything at https://github.com/TendTo/Tutorato-Reti-di-Calcolatori.","color:lime;background:black;"),console.log("%c If you think you can improve the repulsive visual presentation, you are more than welcome to do so.","font-weight: bold; font-size: 32px;color: red; text-shadow: 2px 2px 0 rgb(217,31,38) , 4px 4px 0 rgb(226,91,14) , 6px 6px 0 rgb(245,221,8) , 8px 8px 0 rgb(5,148,68) , 10px 10px 0 rgb(2,135,206) , 12px 12px 0 rgb(4,77,145) , 14px 14px 0 rgb(42,21,113)");let t=new InputManager,e=new CanvasDrawer,s=new InfoManager,r=(t,r,i)=>{s.update(),e.clear(),e.drawIpTree(i?t.network:t,r)};t.onUpdateIp=r,e.onMouseClick=s.update.bind(s),r(t.ip,t.treeHeight,t.toNetworkValue)};